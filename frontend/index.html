<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link rel="manifest" href="/manifest.json?v=2">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#60a5fa" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Wizard Tracker" />
    
    <!-- iOS Startup Images for PWA splash screens -->
    <!-- iPhone X, XS, 11 Pro, 12 mini, 13 mini -->
    <link rel="apple-touch-startup-image" 
          media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" 
          href="/icons/pwa-512x512-v3.png">
    <!-- iPhone XR, 11, 12, 13, 14 -->
    <link rel="apple-touch-startup-image" 
          media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" 
          href="/icons/pwa-512x512-v3.png">
    <!-- iPhone 12 Pro, 13 Pro, 14 Pro -->
    <link rel="apple-touch-startup-image" 
          media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" 
          href="/icons/pwa-512x512-v3.png">
    <!-- iPhone 6, 7, 8, SE (2nd/3rd gen) -->
    <link rel="apple-touch-startup-image" 
          media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" 
          href="/icons/pwa-512x512-v3.png">
    <!-- iPad -->
    <link rel="apple-touch-startup-image" 
          media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" 
          href="/icons/pwa-512x512-v3.png">
    
    <title>Wizard Tracker</title>
    
    <style>
      /* Critical CSS - Theme variables for immediate loading */
      :root {
        --primary-color: #60a5fa;
        --primary-dark: #3563e9;
        --primary-light: #93c5fd;
        --text-color: #2d3748;
        --text-light: #4a5568;
        --background-color: #dde4eb;
        --card-background: #f0f7ff;
        --border-light: #e2e8f0;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --spacing-sm: 0.5rem;
        --spacing-md: 1rem;
      }

      /* Dark theme detection and variables */
      @media (prefers-color-scheme: dark) {
        :root {
          --primary-color: #60a5fa;
          --text-color: #e5e7eb;
          --text-light: #9ca3af;
          --background-color: #1f2937;
          --card-background: #111827;
          --border-light: #4b5563;
          --shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
        }
      }

      /* Manual dark theme override */
      [data-theme="dark"] {
        --primary-color: #60a5fa;
        --text-color: #e5e7eb;
        --text-light: #9ca3af;
        --background-color: #1f2937;
        --card-background: #111827;
        --border-light: #4b5563;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
      }

      /* Prevent any white flashes */
      * {
        box-sizing: border-box;
      }

      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: var(--background-color);
        color: var(--text-color);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        transition: background-color 0.3s ease, color 0.3s ease;
        overflow-x: hidden;
      }

      #root {
        min-height: 100vh;
        background-color: var(--background-color);
        transition: background-color 0.3s ease;
      }

      /* Enhanced loading indicator for immediate display */
      .pwa-loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: var(--background-color);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 1;
        visibility: visible;
      }

      .pwa-loading.fade-out {
        opacity: 0;
        transform: scale(0.95) rotateY(15deg);
        filter: blur(2px);
        visibility: hidden;
      }

      /* Background particles */
      .pwa-particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
      }

      .pwa-particle {
        position: absolute;
        width: 2px;
        height: 2px;
        background: var(--primary-color);
        border-radius: 50%;
        animation: pwatwinkle linear infinite;
        opacity: 0.6;
      }

      @keyframes pwatwinkle {
        0%, 100% { opacity: 0; transform: scale(0); }
        50% { opacity: 1; transform: scale(1); }
      }

      .pwa-content {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        animation: pwaSlideUp 1s ease-out;
        z-index: 10;
      }

      @keyframes pwaSlideUp {
        from { opacity: 0; transform: translateY(40px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .pwa-app-info {
        margin-bottom: 0.5rem;
      }

      .pwa-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0 0 0.5rem;
        color: var(--primary-color);
        animation: pwaTitleGlow 3s ease-in-out infinite alternate;
      }

      @keyframes pwaTitleGlow {
        from { filter: brightness(1); }
        to { filter: brightness(1.1); }
      }

      .pwa-subtitle {
        font-size: 1.1rem;
        font-weight: 300;
        color: var(--text-light);
        letter-spacing: 0.5px;
        margin: 0;
      }

      /* Magic spinner - matching AppLoadingScreen */
      .pwa-loading-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 60px;
        height: 60px;
      }

      .pwa-magic-spinner {
        margin-top: 2rem;
        width: 60px;
        height: 60px;
        background: var(--primary-color);
        clip-path: polygon(
          50% 0%, 60% 35%, 98% 35%, 68% 57%,
          79% 91%, 50% 70%, 21% 91%, 32% 57%,
          2% 35%, 40% 35%
        );
        animation: pwaRotateRune 2.5s linear infinite;
        box-shadow: 0 0 12px var(--primary-color);
      }

      @keyframes pwaRotateRune {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      /* Hide initially until React takes over */
      .app-content {
        opacity: 0;
        transition: opacity 0.4s ease-out;
      }

      .app-content.loaded {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <!-- Initial PWA loading screen -->
    <div id="pwa-loading" class="pwa-loading">
      <div class="pwa-particles">
        <div class="pwa-particle" style="left: 10%; top: 20%; animation-delay: 0s; animation-duration: 3s;"></div>
        <div class="pwa-particle" style="left: 20%; top: 80%; animation-delay: 0.5s; animation-duration: 4s;"></div>
        <div class="pwa-particle" style="left: 60%; top: 30%; animation-delay: 1s; animation-duration: 3.5s;"></div>
        <div class="pwa-particle" style="left: 80%; top: 70%; animation-delay: 1.5s; animation-duration: 4.5s;"></div>
        <div class="pwa-particle" style="left: 90%; top: 10%; animation-delay: 2s; animation-duration: 3.2s;"></div>
        <div class="pwa-particle" style="left: 40%; top: 90%; animation-delay: 2.5s; animation-duration: 4.2s;"></div>
        <div class="pwa-particle" style="left: 15%; top: 50%; animation-delay: 0.8s; animation-duration: 3.8s;"></div>
        <div class="pwa-particle" style="left: 75%; top: 15%; animation-delay: 1.2s; animation-duration: 4.8s;"></div>
        <div class="pwa-particle" style="left: 30%; top: 60%; animation-delay: 1.8s; animation-duration: 3.3s;"></div>
        <div class="pwa-particle" style="left: 85%; top: 45%; animation-delay: 0.3s; animation-duration: 4.3s;"></div>
        <div class="pwa-particle" style="left: 5%; top: 75%; animation-delay: 2.2s; animation-duration: 3.7s;"></div>
        <div class="pwa-particle" style="left: 65%; top: 5%; animation-delay: 1.7s; animation-duration: 4.7s;"></div>
      </div>
    </div>

    <div id="root" class="app-content"></div>
    <script type="module" src="/src/app/main.jsx"></script>

    <script>
      // PWA loading screen management
      let pwaLoadingHidden = false;
      
      // Hide PWA loading when React app is ready (with minimum display time)
      const hidePwaLoading = () => {
        if (pwaLoadingHidden) return;
        pwaLoadingHidden = true;
        
        const pwaLoading = document.getElementById('pwa-loading');
        const appContent = document.getElementById('root');
        
        if (pwaLoading && appContent) {
          // Add fade out animation
          pwaLoading.classList.add('fade-out');
          appContent.classList.add('loaded');
          
          // Remove PWA loading element after animation completes
          setTimeout(() => {
            if (pwaLoading.parentNode) {
              pwaLoading.parentNode.removeChild(pwaLoading);
            }
          }, 600);
        }
      };

      // Minimum display time for branding
      const minDisplayTime = 800;
      let startTime = Date.now();
      let reactReady = false;

      // React app ready signal
      window.addEventListener('app-ready', () => {
        reactReady = true;
        const elapsed = Date.now() - startTime;
        const remaining = Math.max(0, minDisplayTime - elapsed);
        
        setTimeout(hidePwaLoading, remaining);
      });

      // Fallback: hide after maximum time even if React doesn't signal ready
      setTimeout(() => {
        if (!pwaLoadingHidden) {
          console.warn('React app did not signal ready, hiding PWA loading after timeout');
          hidePwaLoading();
        }
      }, 3000);

      // Theme detection and persistence
      const initTheme = () => {
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = savedTheme || (prefersDark ? 'dark' : 'light');
        
        if (theme === 'dark') {
          document.documentElement.setAttribute('data-theme', 'dark');
        }
      };

      // Initialize theme immediately
      initTheme();
    </script>
  </body>
</html>
